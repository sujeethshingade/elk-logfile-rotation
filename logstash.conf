input {
    tcp {
        port => 5000
        codec => json
    }
}

filter {
    # Parse the timestamp
    date {
        match => [ "timestamp", "ISO8601" ]
        target => "@timestamp"
        remove_field => [ "timestamp" ]
    }
    
    # Ensure all fields are properly indexed with consistent types
    mutate {
        convert => {
            "container_id" => "integer"
            "random_number" => "integer"
        }
    }
}

output {
    elasticsearch {
        hosts => ["elasticsearch:9200"]
        index => "logs-%{+YYYY.MM.dd}"
        
        # Basic settings
        ssl => false
        
        # Use simpler template configuration for ES 8.x
        manage_template => true
        template => "/usr/share/logstash/config/templates/logs_template.json"
        template_name => "logs_template"
        template_overwrite => true
    }
    
    # Output to stdout for debugging
    stdout { codec => rubydebug }
}